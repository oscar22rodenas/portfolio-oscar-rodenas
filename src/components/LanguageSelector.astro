---
import { languages, defaultLang } from '../../i18n/ui';

const { lang } = Astro.props;
const path = Astro.url.pathname;

const pathWithoutLang = path.startsWith(`/${lang}`) ? path.slice(`/${lang}`.length) : path;
---

<div class="relative group">
  <button class="bg-transparent border border-gray-300 dark:border-gray-700 rounded-lg px-3 py-1.5 text-sm flex items-center gap-2" aria-label="Language selector">
    <span>{languages[lang]}</span>
    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
  </button>
  <ul class="absolute hidden group-hover:block bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg mt-1 w-full" aria-label="Available languages">
    {Object.entries(languages).map(([code, name]) => (
      <li>
        <a 
          href={code === defaultLang ? pathWithoutLang : `/${code}${pathWithoutLang}`} 
          class="block px-3 py-1.5 text-sm hover:bg-gray-100 dark:hover:bg-gray-700"
          aria-current={code === lang ? "page" : false}
        >
          {name}
        </a>
      </li>
    ))}
  </ul>
</div>